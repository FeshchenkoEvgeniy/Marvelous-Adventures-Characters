{"version":3,"file":"characters.js","sources":["../src/js/mainCharactersForm.ts","../src/js/mainCharactersGetCategory.ts","../src/js/mainCharactersMarkup.ts"],"sourcesContent":["import flatpickr from \"flatpickr\";\nimport \"flatpickr/dist/flatpickr.min.css\";\nimport \"flatpickr/dist/themes/dark.css\";\nimport { debounce } from \"throttle-debounce\";\n\nconst datePicker = document.querySelector('#date-picker') as HTMLInputElement\nconst jsFilterForm = document.querySelector('.js-filter-form') as HTMLFormElement\n\ninterface IfilterObj {\n    comics: null | string,\n    name: null | string,\n    orderBy: null | string,\n    date: null | string,\n}\n\nconst obj: IfilterObj = {\n        comics: null,\n        name: null,\n        orderBy: null,\n        date: null\n    }\n\nfunction filterCharacters(evt: Event) {\n    const target = evt.target as HTMLInputElement | HTMLSelectElement;\n\n    switch (target.name) {\n        case 'comics':\n        obj.comics = target.value.replace(/[^0-9]/g, '')\n        break;\n        case 'name':\n        obj.name = target.value\n        break;\n        case 'orderBy':\n        obj.orderBy = target.value\n        break;\n    }\n   console.log(obj)\n}\n\n    flatpickr(datePicker, {\n    defaultDate: new Date(),\n    allowInput: true,\n    onClose: (selectedDates, dateStr, instance) => {\n        if (!isValidDate(dateStr)) {\n            Notiflix.Notify.failure('Invalid date format. Expected YYYY-MM-DD');\n            instance.clear()\n            obj.date = null\n            return\n        } else {\n            obj.date = dateStr\n        }\n    }\n});\n\nfunction isValidDate(dateStr: string): boolean {\n    return /^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)\n}\n\n\njsFilterForm.addEventListener('input', debounce(800, filterCharacters))","function getCategory() {\n    if (window.innerWidth <= 767) {\n        return { limit: 5, offset: 0, requiredCharacters: 5, currentCategory: 'mobile' };\n    } else if (window.innerWidth <= 1439) {\n        return { limit: 8, offset: 0, requiredCharacters: 8, currentCategory: 'tablet' };\n    } else {\n        return { limit: 16, offset: 0, requiredCharacters: 16, currentCategory: 'desktop' };\n    }\n}\n\nexport {getCategory}","import { fetchAllCharacters } from \"./api\";\nimport { debounce } from 'throttle-debounce';\nimport { ICharacters, IinitialState } from './interface'\nimport { getCategory } from \"./mainCharactersGetCategory\";\n\nconst charactersList = document.querySelector('.js-characters-list') as HTMLElement;\nconst loadMoreBtn = document.querySelector('.js-main-character__btn') as HTMLElement;\nconst loader = document.querySelector('.js-loader') as HTMLElement;\nconst body = document.querySelector('body') as HTMLElement\n\nconst { limit, offset, requiredCharacters, currentCategory } = getCategory();\n\nconst initialState: IinitialState = {\n    limit,\n    offset,\n    requiredCharacters,\n    currentCategory,\n}\nlet setLoading = true;\n\n    window.addEventListener('resize', debounce(1000, handleResize));\n    loadMoreBtn.addEventListener('click', loadMoreCharacters);\n    \n    filterValidateCharacters();\n    \n\nfunction handleResize() {\n    const newCategory = getCategory();\n\n    if (newCategory.currentCategory !== initialState.currentCategory) {\n        initialState.currentCategory = newCategory.currentCategory;\n        initialState.limit = newCategory.limit;\n        initialState.offset = 0; \n        initialState.requiredCharacters = newCategory.requiredCharacters;\n\n        charactersList.innerHTML = '';\n\n        filterValidateCharacters();\n    }\n}\n\nfunction showLoader() {\n    if (setLoading) {\n        loader.style.display = 'block';\n        body.style.pointerEvents = 'none'    \n    } else {\n        loader.style.display = 'none';\n        body.style.pointerEvents = 'all' \n    }\n}\n\nasync function filterValidateCharacters() {\n    let validCharacters: ICharacters[] = [];\n\n    loadMoreBtn.style.display = 'none'    \n   \n    setLoading = true\n    showLoader()\n\n    while (validCharacters.length < initialState.requiredCharacters) {\n        try {\n            const { data } = await fetchAllCharacters(initialState.offset, initialState.limit);\n\n            const filteredCharacters = data.results.filter(({ thumbnail: { path } }: ICharacters) => {\n                return !path.endsWith('image_not_available') && !path.endsWith('4c002e0305708');\n            });\n\n            validCharacters = [...validCharacters, ...filteredCharacters];\n\n            initialState.offset += initialState.limit;\n        } catch (err) {\n            console.log(\"Помилка під час запиту:\", err);\n            break;\n        }\n\n        if (validCharacters.length >= initialState.requiredCharacters) {\n            validCharacters = validCharacters.slice(0, initialState.requiredCharacters);\n            loadMoreBtn.style.display = 'block'\n            setLoading = false\n            showLoader()\n            break;\n        }\n    }\n\n    charactersList.insertAdjacentHTML('beforeend', createMarkup(validCharacters));\n}\n\n\nfunction loadMoreCharacters() {\n        if (initialState.offset >= 1500) {\n            loadMoreBtn.style.display = 'none'\n        }\n    filterValidateCharacters();\n}\n\nfunction createMarkup(arr: ICharacters[]): string {\n    return arr.map(({ name, resourceURI, thumbnail: { extension, path } }) => {\n        return `\n            <li class=\"characters__item\" data-url='${resourceURI}'>\n                <img src=\"${path}.${extension}\" alt=\"${name}\" class=\"characters__img\" />\n                <p class=\"characters__name\">${name}</p>\n            </li>\n        `;\n    }).join('');\n}"],"names":["datePicker","jsFilterForm","obj","filterCharacters","evt","target","flatpickr","selectedDates","dateStr","instance","isValidDate","debounce","getCategory","charactersList","loadMoreBtn","loader","body","limit","offset","requiredCharacters","currentCategory","initialState","setLoading","handleResize","loadMoreCharacters","filterValidateCharacters","newCategory","showLoader","validCharacters","data","fetchAllCharacters","filteredCharacters","path","err","createMarkup","arr","name","resourceURI","extension"],"mappings":"oGAKA,MAAMA,EAAa,SAAS,cAAc,cAAc,EAClDC,EAAe,SAAS,cAAc,iBAAiB,EASvDC,EAAkB,CAChB,OAAQ,KACR,KAAM,KACN,QAAS,KACT,KAAM,IACV,EAEJ,SAASC,EAAiBC,EAAY,CAClC,MAAMC,EAASD,EAAI,OAEnB,OAAQC,EAAO,KAAM,CACjB,IAAK,SACLH,EAAI,OAASG,EAAO,MAAM,QAAQ,UAAW,EAAE,EAC/C,MACA,IAAK,OACLH,EAAI,KAAOG,EAAO,MAClB,MACA,IAAK,UACLH,EAAI,QAAUG,EAAO,MACrB,KACJ,CACD,QAAQ,IAAIH,CAAG,CAClB,CAEII,EAAUN,EAAY,CACtB,gBAAiB,KACjB,WAAY,GACZ,QAAS,CAACO,EAAeC,EAASC,IAAa,CACvC,GAACC,EAAYF,CAAO,EAMpBN,EAAI,KAAOM,MANY,CACd,SAAA,OAAO,QAAQ,0CAA0C,EAClEC,EAAS,MAAM,EACfP,EAAI,KAAO,KACX,MAAA,CAIR,CACJ,CAAC,EAED,SAASQ,EAAYF,EAA0B,CACpC,MAAA,sBAAsB,KAAKA,CAAO,CAC7C,CAGAP,EAAa,iBAAiB,QAASU,EAAS,IAAKR,CAAgB,CAAC,EC3DtE,SAASS,GAAc,CACf,OAAA,OAAO,YAAc,IACd,CAAE,MAAO,EAAG,OAAQ,EAAG,mBAAoB,EAAG,gBAAiB,UAC/D,OAAO,YAAc,KACrB,CAAE,MAAO,EAAG,OAAQ,EAAG,mBAAoB,EAAG,gBAAiB,UAE/D,CAAE,MAAO,GAAI,OAAQ,EAAG,mBAAoB,GAAI,gBAAiB,UAEhF,CCHA,MAAMC,EAAiB,SAAS,cAAc,qBAAqB,EAC7DC,EAAc,SAAS,cAAc,yBAAyB,EAC9DC,EAAS,SAAS,cAAc,YAAY,EAC5CC,EAAO,SAAS,cAAc,MAAM,EAEpC,CAAE,MAAAC,EAAO,OAAAC,EAAQ,mBAAAC,EAAoB,gBAAAC,GAAoBR,EAAY,EAErES,EAA8B,CAChC,MAAAJ,EACA,OAAAC,EACA,mBAAAC,EACA,gBAAAC,CACJ,EACA,IAAIE,EAAa,GAEb,OAAO,iBAAiB,SAAUX,EAAS,IAAMY,CAAY,CAAC,EAC9DT,EAAY,iBAAiB,QAASU,CAAkB,EAExDC,IAGJ,SAASF,GAAe,CACpB,MAAMG,EAAcd,IAEhBc,EAAY,kBAAoBL,EAAa,kBAC7CA,EAAa,gBAAkBK,EAAY,gBAC3CL,EAAa,MAAQK,EAAY,MACjCL,EAAa,OAAS,EACtBA,EAAa,mBAAqBK,EAAY,mBAE9Cb,EAAe,UAAY,GAEFY,IAEjC,CAEA,SAASE,GAAa,CACdL,GACAP,EAAO,MAAM,QAAU,QACvBC,EAAK,MAAM,cAAgB,SAE3BD,EAAO,MAAM,QAAU,OACvBC,EAAK,MAAM,cAAgB,MAEnC,CAEA,eAAeS,GAA2B,CACtC,IAAIG,EAAiC,CAAA,EAO9B,IALPd,EAAY,MAAM,QAAU,OAEfQ,EAAA,GACFK,IAEJC,EAAgB,OAASP,EAAa,oBAAoB,CACzD,GAAA,CACM,KAAA,CAAE,KAAAQ,CAAS,EAAA,MAAMC,EAAmBT,EAAa,OAAQA,EAAa,KAAK,EAE3EU,EAAqBF,EAAK,QAAQ,OAAO,CAAC,CAAE,UAAW,CAAE,KAAAG,CAAK,KACzD,CAACA,EAAK,SAAS,qBAAqB,GAAK,CAACA,EAAK,SAAS,eAAe,CACjF,EAEDJ,EAAkB,CAAC,GAAGA,EAAiB,GAAGG,CAAkB,EAE5DV,EAAa,QAAUA,EAAa,YAC/BY,EAAK,CACF,QAAA,IAAI,0BAA2BA,CAAG,EAC1C,KACJ,CAEI,GAAAL,EAAgB,QAAUP,EAAa,mBAAoB,CAC3DO,EAAkBA,EAAgB,MAAM,EAAGP,EAAa,kBAAkB,EAC1EP,EAAY,MAAM,QAAU,QACfQ,EAAA,GACFK,IACX,KACJ,CACJ,CAEAd,EAAe,mBAAmB,YAAaqB,EAAaN,CAAe,CAAC,CAChF,CAGA,SAASJ,GAAqB,CAClBH,EAAa,QAAU,OACvBP,EAAY,MAAM,QAAU,QAEXW,GAC7B,CAEA,SAASS,EAAaC,EAA4B,CACvC,OAAAA,EAAI,IAAI,CAAC,CAAE,KAAAC,EAAM,YAAAC,EAAa,UAAW,CAAE,UAAAC,EAAW,KAAAN,CAAK,KACvD;AAAA,qDACsCK,CAAW;AAAA,4BACpCL,CAAI,IAAIM,CAAS,UAAUF,CAAI;AAAA,8CACbA,CAAI;AAAA;AAAA,SAG7C,EAAE,KAAK,EAAE,CACd"}