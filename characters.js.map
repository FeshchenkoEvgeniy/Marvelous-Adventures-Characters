{"version":3,"file":"characters.js","sources":["../src/js/mainCharactersGetCategory.ts","../src/js/mainCharacters.ts"],"sourcesContent":["function getCategory() {\n    if (window.innerWidth <= 767) {\n        return { limit: 5, offset: 0, requiredCharacters: 5, currentCategory: 'mobile' };\n    } else if (window.innerWidth <= 1439) {\n        return { limit: 8, offset: 0, requiredCharacters: 8, currentCategory: 'tablet' };\n    } else {\n        return { limit: 16, offset: 0, requiredCharacters: 16, currentCategory: 'desktop' };\n    }\n}\n\nexport {getCategory}","import flatpickr from \"flatpickr\";\nimport \"flatpickr/dist/flatpickr.min.css\";\nimport \"flatpickr/dist/themes/dark.css\";\nimport { debounce } from \"throttle-debounce\";\nimport {IfilterObj, IinitialState, ICharacters} from './interface'\nimport { fetchFilteredCharacters } from \"./api\";\nimport { getCategory } from \"./mainCharactersGetCategory\";\nimport { createMarkupForMainCharactersList } from \"./createMarkup\"\n\ndocument.addEventListener('touchmove', function(e) {\n    e.preventDefault(); // Блокує всі події скролу\n}, { passive: false });\n\nconst datePicker = document.querySelector('#date-picker') as HTMLInputElement\nconst jsFilterForm = document.querySelector('.js-filter-form') as HTMLFormElement\nconst charactersList = document.querySelector('.js-characters-list') as HTMLElement;\nconst loadMoreBtn = document.querySelector('.js-main-character__btn') as HTMLElement;\nconst loader = document.querySelector('.js-loader') as HTMLElement;\nconst body = document.querySelector('body') as HTMLElement\n const notFoundBox = document.querySelector('.notFound__box') as HTMLElement;\n\nconst { limit, offset, requiredCharacters, currentCategory } = getCategory();\n\nconst initialState: IinitialState = {\n    limit,\n    offset,\n    requiredCharacters,\n    currentCategory,\n    total: 0,\n}\n\nconst filterValue: IfilterObj = {\n    comics: null,\n    name: null,\n    orderBy: null,\n    date: null,     \n}\n\nfunction handleResize() {\n    const newCategory = getCategory();\n\n    if (newCategory.currentCategory !== initialState.currentCategory) {\n        initialState.currentCategory = newCategory.currentCategory;\n        initialState.limit = newCategory.limit;\n        initialState.offset = 0; \n        initialState.requiredCharacters = newCategory.requiredCharacters;\n    }\n\n    charactersList.innerHTML = '';\n\n    filterValidateCharacters();\n}\n\nfunction showLoader(isLoading: boolean, showLoadMoreBtn: boolean) {\n    if (isLoading) {\n        loader.style.display = 'block';\n        body.style.pointerEvents = 'none'\n    } else {\n        loader.style.display = 'none';\n        body.style.pointerEvents = 'all' \n    }\n\n    loadMoreBtn.style.display = showLoadMoreBtn ? 'block' : 'none';\n}\n\nfunction checkNotFound(isBolean: boolean) {\n    if (isBolean) {\n        notFoundBox.style.display = ''\n        charactersList.style.display = 'none';\n    } else {\n        notFoundBox.style.display = 'none';\n        charactersList.style.display = '';\n    }\n}\n\nfilterValidateCharacters()\n\nfunction filterCharacters(evt: Event) {\n    const target = evt.target as HTMLInputElement | HTMLSelectElement;\n\n    switch (target.name) {\n        case 'comics':\n        filterValue.comics = target.value.replace(/[^0-9]/g, '')\n        break;\n        case 'name':\n        filterValue.name = target.value\n        break;\n        case 'orderBy':\n        filterValue.orderBy = target.value.toLowerCase()\n        break;\n    }\n    initialState.offset = 0\n    charactersList.innerHTML = ''\n\n    filterValidateCharacters()\n}\n\nasync function filterValidateCharacters() {\n    let validCharacters: ICharacters[] = [];\n\n    showLoader(true, false)\n\n    while (validCharacters.length < initialState.requiredCharacters) {\n        try {\n            const { data } = await fetchFilteredCharacters(filterValue, initialState.offset, initialState.limit);\n            initialState.total = data.total\n\n            checkNotFound(!data.results.length)\n\n            const filteredCharacters = data.results.filter(({ thumbnail: { path } }: ICharacters) => {\n                return !path.endsWith('image_not_available') && !path.endsWith('4c002e0305708');\n            });\n\n            validCharacters = [...validCharacters, ...filteredCharacters];\n\n            initialState.offset += initialState.limit;\n\n        } catch (err) {\n            console.log(\"Помилка під час запиту:\", err);\n            break;\n        }\n        \n        if (initialState.total <= initialState.offset) {\n            showLoader(false, false)\n            break\n        }\n\n        if (validCharacters.length >= initialState.requiredCharacters) {\n            validCharacters = validCharacters.slice(0, initialState.requiredCharacters);\n            showLoader(false, true);\n            break;\n        }\n    }\n\n    charactersList.insertAdjacentHTML('beforeend', createMarkupForMainCharactersList(validCharacters));\n}\n\nfunction loadMoreCharacters() {\n    filterValidateCharacters();\n}\n\nflatpickr(datePicker, {\n    defaultDate: new Date(),\n    allowInput: true,\n    onClose: (selectedDates, dateStr, instance) => {\n        if (!isValidDate(dateStr)) {\n            Notiflix.Notify.failure('Invalid date format. Expected YYYY-MM-DD');\n            instance.clear()\n            filterValue.date = null\n            return\n        } else {\n            filterValue.date = dateStr\n        }\n    }\n});\n\n\nfunction isValidDate(dateStr: string): boolean {\n    return /^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)\n}\n\nloadMoreBtn.addEventListener('click', loadMoreCharacters);\njsFilterForm.addEventListener('input', debounce(800, filterCharacters))\nwindow.addEventListener('resize', debounce(1000, handleResize));"],"names":["getCategory","datePicker","jsFilterForm","charactersList","loadMoreBtn","loader","body","notFoundBox","limit","offset","requiredCharacters","currentCategory","initialState","filterValue","handleResize","newCategory","filterValidateCharacters","showLoader","isLoading","showLoadMoreBtn","checkNotFound","isBolean","filterCharacters","evt","target","validCharacters","data","fetchFilteredCharacters","filteredCharacters","path","err","createMarkupForMainCharactersList","loadMoreCharacters","flatpickr","selectedDates","dateStr","instance","isValidDate","debounce"],"mappings":"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"}