{"version":3,"file":"characters.js","sources":["../src/js/mainCharactersGetCategory.ts","../src/js/mainCharacters.ts","../src/js/mainCharactersComicsModal.ts","../src/js/mainCharactersModal.ts"],"sourcesContent":["function getCategory() {\n    if (window.innerWidth <= 767) {\n        return { limit: 5, offset: 0, requiredCharacters: 5, currentCategory: 'mobile' };\n    } else if (window.innerWidth <= 1439) {\n        return { limit: 8, offset: 0, requiredCharacters: 8, currentCategory: 'tablet' };\n    } else {\n        return { limit: 16, offset: 0, requiredCharacters: 16, currentCategory: 'desktop' };\n    }\n}\n\nexport {getCategory}","import flatpickr from \"flatpickr\";\nimport \"flatpickr/dist/flatpickr.min.css\";\nimport \"flatpickr/dist/themes/dark.css\";\nimport { debounce } from \"throttle-debounce\";\nimport {IfilterObj, IinitialState, ICharacters} from './interface'\nimport { fetchFilteredCharacters } from \"./api\";\nimport { getCategory } from \"./mainCharactersGetCategory\";\nimport { createMarkupForMainCharactersList } from \"./createMarkup\"\n\nconst datePicker = document.querySelector('#date-picker') as HTMLInputElement\nconst jsFilterForm = document.querySelector('.js-filter-form') as HTMLFormElement\nconst charactersList = document.querySelector('.js-characters-list') as HTMLElement;\nconst loadMoreBtn = document.querySelector('.js-main-character__btn') as HTMLElement;\nconst loader = document.querySelector('.js-loader') as HTMLElement;\nconst body = document.querySelector('body') as HTMLElement\n const notFoundBox = document.querySelector('.notFound__box') as HTMLElement;\n\nconst { limit, offset, requiredCharacters, currentCategory } = getCategory();\n\nconst initialState: IinitialState = {\n    limit,\n    offset,\n    requiredCharacters,\n    currentCategory,\n    total: 0,\n}\n\nconst filterValue: IfilterObj = {\n    comics: null,\n    name: null,\n    orderBy: null,\n    date: null,     \n}\n\nfunction handleResize() {\n    const newCategory = getCategory();\n\n    if (newCategory.currentCategory !== initialState.currentCategory) {\n        initialState.currentCategory = newCategory.currentCategory;\n        initialState.limit = newCategory.limit;\n        initialState.offset = 0; \n        initialState.requiredCharacters = newCategory.requiredCharacters;\n        filterValidateCharacters();\n        charactersList.innerHTML = '';\n    }\n}\n\nfunction showLoader(isLoading: boolean, showLoadMoreBtn: boolean) {\n    if (isLoading) {\n        loader.style.display = 'block';\n        body.style.pointerEvents = 'none'\n    } else {\n        loader.style.display = 'none';\n        body.style.pointerEvents = 'all' \n    }\n\n    loadMoreBtn.style.display = showLoadMoreBtn ? 'block' : 'none';\n}\n\nfunction checkNotFound(isBolean: boolean) {\n    if (isBolean) {\n        notFoundBox.style.display = ''\n        charactersList.style.display = 'none';\n    } else {\n        notFoundBox.style.display = 'none';\n        charactersList.style.display = '';\n    }\n}\n\nfilterValidateCharacters()\n\nfunction filterCharacters(evt: Event) {\n    const target = evt.target as HTMLInputElement | HTMLSelectElement;\n\n    switch (target.name) {\n        case 'comics':\n        filterValue.comics = target.value.replace(/[^0-9]/g, '')\n        break;\n        case 'name':\n        filterValue.name = target.value\n        break;\n        case 'orderBy':\n        filterValue.orderBy = target.value.toLowerCase()\n        break;\n    }\n    initialState.offset = 0\n    charactersList.innerHTML = ''\n\n    filterValidateCharacters()\n}\n\nasync function filterValidateCharacters() {\n    let validCharacters: ICharacters[] = [];\n\n    showLoader(true, false)\n\n    while (validCharacters.length < initialState.requiredCharacters) {\n        try {\n            const { data } = await fetchFilteredCharacters(filterValue, initialState.offset, initialState.limit);\n            initialState.total = data.total\n\n            checkNotFound(!data.results.length)\n\n            const filteredCharacters = data.results.filter(({ thumbnail: { path } }: ICharacters) => {\n                return !path.endsWith('image_not_available') && !path.endsWith('4c002e0305708');\n            });\n\n            validCharacters = [...validCharacters, ...filteredCharacters];\n\n            initialState.offset += initialState.limit;\n\n        } catch (err) {\n            console.log(\"Помилка під час запиту:\", err);\n            break;\n        }\n        \n        if (initialState.total <= initialState.offset) {\n            showLoader(false, false)\n            break\n        }\n\n        if (validCharacters.length >= initialState.requiredCharacters) {\n            validCharacters = validCharacters.slice(0, initialState.requiredCharacters);\n            showLoader(false, true);\n            break;\n        }\n    }\n\n    charactersList.insertAdjacentHTML('beforeend', createMarkupForMainCharactersList(validCharacters));\n}\n\nfunction loadMoreCharacters() {\n    filterValidateCharacters();\n}\n\nflatpickr(datePicker, {\n    defaultDate: new Date(),\n    allowInput: true,\n    onClose: (selectedDates, dateStr, instance) => {\n        if (!isValidDate(dateStr)) {\n            Notiflix.Notify.failure('Invalid date format. Expected YYYY-MM-DD');\n            instance.clear()\n            filterValue.date = null\n            return\n        } else {\n            filterValue.date = dateStr\n        }\n    }\n});\n\n\nfunction isValidDate(dateStr: string): boolean {\n    return /^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)\n}\n\nloadMoreBtn.addEventListener('click', loadMoreCharacters);\njsFilterForm.addEventListener('input', debounce(800, filterCharacters))\nwindow.addEventListener('resize', debounce(1000, handleResize));","import * as basicLightbox from 'basiclightbox'\nimport 'basiclightbox/dist/basicLightbox.min.css'\nimport { fetchComicsById } from \"./api\";\nimport {createMarkupForModalComics} from './createMarkup'\n \nexport function isLoad() {\nconst charactersModaList = document.querySelector('.js-characters-modal__list') as HTMLElement;\nconst body = document.querySelector('body') as HTMLElement;\n\nlet handler: (evt: KeyboardEvent) => void;\nconst options = {\n    onShow(instance: any) {\n        handler = closeModal.bind(instance);\n   \n        document.addEventListener('keydown', handler);\n        body.style.overflowY = 'hidden' \n            \n        return true\n    },\n    onClose() {\n        body.style.overflowY = ''\n        document.removeEventListener('keydown', handler);\n\n        return true\n    }\n}    \n    \nfunction onClick(evt: Event) {\n    const target = evt.target as HTMLElement\n    if (target.classList.contains('js-characters-list')) {\n        return\n    }\n    const listItem = target.closest('.characters-modal__item') as HTMLElement;\n    const comicsId = listItem?.dataset.comicsid\n    \n    if (comicsId) {\n        fetchComicsById(comicsId)\n        .then((data) => {\n        const instance = basicLightbox.create(createMarkupForModalComics(data),options)\n        instance.show()    \n        })\n        .catch(err => console.log(err))\n    }\n}\n\nfunction closeModal(this: any, evt: KeyboardEvent) {\n  if (evt.code === 'Escape') {\n    this.close();\n  }\n}    \n    \ncharactersModaList.addEventListener('click', onClick)\n}","import * as basicLightbox from 'basiclightbox'\nimport 'basiclightbox/dist/basicLightbox.min.css'\nimport { fetchCharactersById } from \"./api\";\nimport { createMarkupForModalCharacters } from './createMarkup';\nimport { isLoad } from './mainCharactersComicsModal';\n\nconst charactersList = document.querySelector('.js-characters-list') as HTMLElement;\nconst body = document.querySelector('body') as HTMLElement\n\nlet handler: (evt: KeyboardEvent) => void;\nconst options = {\n    onShow(instance: any) {\n        handler = closeModal.bind(instance);\n   \n        document.addEventListener('keydown', handler);\n        body.style.overflowY = 'hidden' \n            \n        return true\n    },\n    onClose() {\n        body.style.overflowY = ''\n        document.removeEventListener('keydown', handler);\n\n        return true\n    }\n}\n\nfunction onClick(evt: Event) {\n    const target = evt.target as HTMLElement\n\n    if (target.classList.contains('js-characters-list')) {\n        return\n    }\n\n    const listItem = target.closest('.characters__item') as HTMLElement;\n    const url = listItem?.dataset.url\n\n    if (url) {\n    body.style.pointerEvents = 'none'\n \n    fetchCharactersById(url)\n    .then((data) => {    \n    const instance = basicLightbox.create(createMarkupForModalCharacters(data),options)\n    instance.show()   \n    })\n    .catch(err => console.log(err))\n    .finally(() => {\n    body.style.pointerEvents = 'all'\n    isLoad()\n    })\n    } else {\n        console.error('URL not found');\n    }\n}\n\nfunction closeModal(this: any, evt: KeyboardEvent) {\n  if (evt.code === 'Escape') {\n    this.close();\n  }\n}\n\ncharactersList.addEventListener('click', onClick)"],"names":["getCategory","datePicker","jsFilterForm","charactersList","loadMoreBtn","loader","body","notFoundBox","limit","offset","requiredCharacters","currentCategory","initialState","filterValue","handleResize","newCategory","filterValidateCharacters","showLoader","isLoading","showLoadMoreBtn","checkNotFound","isBolean","filterCharacters","evt","target","validCharacters","data","fetchFilteredCharacters","filteredCharacters","path","err","createMarkupForMainCharactersList","loadMoreCharacters","flatpickr","selectedDates","dateStr","instance","isValidDate","debounce","isLoad","charactersModaList","handler","options","closeModal","onClick","listItem","comicsId","fetchComicsById","basicLightbox.create","createMarkupForModalComics","url","fetchCharactersById","createMarkupForModalCharacters"],"mappings":"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"}